###############################################################################
#                           generated by chef
###############################################################################

# for an overview of all the available configuration options
# go to: https://docs.openstack.org/glance/pike/configuration/glance_api.html
#
[DEFAULT]
debug = <%= node['bcpc']['glance']['debug'] %>
show_image_direct_url = true
enable_v1_api = false
enable_v2_api = true
bind_host = <%= node['service_ip'] %>
bind_port = 9292
workers = <%= node['bcpc']['glance']['workers'] %>
admin_role = <%= node['bcpc']['keystone']['roles']['admin'] %>
image_cache_dir = /var/lib/glance/image-cache/
log_file = /var/log/glance/api.log
transport_url = rabbit://<%= @headnodes.map{|x| "#{@config['rabbit']['username']}:#{@config['rabbit']['password']}@#{x['service_ip']}:5672" }.join(',') %>


[database]
connection = mysql+pymysql://<%= @db['username'] %>:<%= @db['password'] %>@<%= @db['host'] %>/<%= @db['dbname'] %>
max_pool_size=<%= node['bcpc']['glance']['db']['max_pool_size'] %>
max_overflow=<%= node['bcpc']['glance']['db']['max_overflow'] %>


[glance_store]
stores = rbd
default_store = rbd
rbd_store_pool = <%= node['bcpc']['glance']['ceph']['pool']['name'] %>
rbd_store_user = <%= node['bcpc']['glance']['ceph']['user'] %>
rbd_store_ceph_conf = /etc/ceph/ceph.conf


[image_format]
container_formats = ami,ari,aki,bare,ovf,ova,docker
disk_formats = ami,ari,aki,vhd,vhdx,vmdk,raw,qcow2,vdi,iso,ploop.root-tar


[keystone_authtoken]
auth_uri = https://<%= node['bcpc']['cloud']['fqdn'] %>:5000/v3/
auth_url = https://<%= node['bcpc']['cloud']['fqdn'] %>:35357
memcached_servers = <%= @headnodes.map{|x| "#{x['service_ip']}:11211" }.join(',') %>
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = <%= @os['username'] %>
password = <%= @os['password'] %>

[oslo_concurrency]
lock_path = /var/lock/glance

[oslo_messaging_rabbit]
amqp_durable_queues = <%= node['bcpc']['rabbitmq']['durable_queues'] %>


[paste_deploy]
flavor = keystone
